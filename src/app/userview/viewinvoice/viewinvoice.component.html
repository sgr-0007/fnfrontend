<h2>Invoice List</h2>
<p-table #dt2 dataKey="invoiceid" editMode="row"  [paginator]="true"  currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries" 
[rowsPerPageOptions]="[10,25,50]" [rows]="rows" [(first)]="first" 
 class="mt-3" [value]="invoice"   [scrollable]="true" scrollHeight="400px" scrollDirection="both"
 [globalFilterFields]="['buyerName','invoicenumber','invoicedate','representative.name','status']" [loading]="loading">
 <ng-template pTemplate="caption">
    <!-- <div class="flex">
        <span class="p-input-icon-left ml-auto">
            <i class="pi pi-search"></i>
            <input pInputText type="text" (input)="dt2.filterGlobal($any($event.target).value, 'contains')" placeholder="Search keyword" />
        </span>
    </div>
    <div class="col text-end">     
        <span class="p-input-icon-left ml-auto">
            <i class="pi pi-search"></i>
            <p-dropdown name="companyname" appendTo="body" [filter]="true"  filterBy="companyname" [required]="true"
            (onChange)="filterbybranch()" [options]="companies" optionLabel="companyname" [(ngModel)]="filteredbranchid"
            optionValue="companyid" >
          </p-dropdown>
        </span>
        </div>

      </div>-->
      <div class="row align-left">   
        <div class="col text-start">     
        <span class="p-input-icon-left ml-auto">
            <i class="pi pi-search"></i>
            <input pInputText type="text" (input)="dt2.filterGlobal($any($event.target).value, 'contains')" placeholder="Search keyword" />
        </span>
        </div>
        <div class="col text-end">     
            <span class="p-input-icon-left ml-auto">
                <i class="pi pi-search"></i>
                <p-dropdown name="companyname" placeholder="Filter By Auction type" [autoDisplayFirst]=false [showClear]="true" appendTo="body" [filter]="true"  filterBy="companyname" [required]="true"
                (onChange)="filterbyAuctionType()" [options]="auctiontype" optionLabel="label" [(ngModel)]="selectedauctionType"
                optionValue="id" >
              </p-dropdown>
            </span>
            </div>
    
        <div class="col text-end">     
            <span class="p-input-icon-left ml-auto">
                <i class="pi pi-search"></i>
                <p-dropdown name="companyname" placeholder="Filter By Branch type" [autoDisplayFirst]=false [showClear]="true" appendTo="body" [filter]="true"  filterBy="companyname" [required]="true"
                (onChange)="filterbybranch()" [options]="companies" optionLabel="companyname" [(ngModel)]="filteredbranchid"
                optionValue="companyid" >
              </p-dropdown>
            </span>
            </div>
    
          </div>

    
</ng-template>   
 <ng-template  pTemplate="header">
        <!-- <tr>
            <th colspan="5"></th>
            <th colspan="4">Buyer Details</th>
            <th colspan="4"> Supplier Details</th>
            <th colspan="6"> GST Details</th>
            <th colspan="2"></th>
        </tr> -->

        <tr>
            <!-- <th>SNO</th> -->
            <th pSortableColumn="invoicenumber" style="width:200px">
                <div class="flex justify-content-center align-items-center">
                    Invoice No
             <!--        <p-columnFilter type="text" field="invoicenumber" dateFormat="dd.mm.yy" display="menu"></p-columnFilter> -->
                    <p-sortIcon field="invoicenumber"></p-sortIcon>
                </div>
               </th>
            <th pSortableColumn="invoicedate" style="width:150px">
                <div class="flex justify-content-center align-items-center">
                    Invoice Date
                    <!-- <p-columnFilter type="date" field="invoicedate" display="menu"></p-columnFilter> -->
                    <p-sortIcon field="invoicedate"></p-sortIcon>
                </div>
            </th>
            <!-- <th>Invoice Period</th> -->
            <th pSortableColumn="paymentduedate" style="width:150px">
                Due Date
                <p-sortIcon field="paymentduedate"></p-sortIcon>
            </th>
            <th pSortableColumn="buyerName" style="width:150px">
                <div class="flex justify-content-center align-items-center">
                    Buyer Name
                    <p-sortIcon field="buyerName"></p-sortIcon>
                    <!-- <p-columnFilter type="text" field="buyerName" display="menu"></p-columnFilter> -->
                </div>
                
            </th>
            <!-- <th>Buyer Name</th> -->
            <th pSortableColumn="supplierName" style="width:150px">
                Supplier Name
                <p-sortIcon field="supplierName"></p-sortIcon>
            </th>
            <!-- 
            <th>SGST Rate</th>
            <th>SGST Value</th>
            <th>CGST Rate</th>
            <th>CGST Value</th>
            <th>IGST(%)</th>
            <th>IGST Value</th> -->
            <th pSortableColumn="invoicetotal" style="width:150px">
                Total
                <p-sortIcon field="invoicetotal"></p-sortIcon>
            </th>
            <th pSortableColumn="paymentbalance" style="width:150px">
                Balance
                <p-sortIcon field="paymentbalance"></p-sortIcon>
            </th>
            <th pSortableColumn="paymentamountpaid" style="width:150px">
                Paid
                <p-sortIcon field="paymentamountpaid"></p-sortIcon>
            </th>
            <th pSortableColumn="approververifiedstatus" style="width:150px">
                Approval Status
                <p-sortIcon field="approververifiedstatus"></p-sortIcon>
            </th>
            <th  style="width:300px">Action</th>
        </tr>
    </ng-template>
    <ng-template let-invitem pTemplate="body" let-ri="rowIndex"  let-editing="editing" >
        <tr [pEditableRow]="invitem">
            <!-- <td>{{invitem.invoiceid}}</td> -->
            <td style="width:200px">{{invitem.invoicenumber}}</td>
            <td style="width:150px">{{invitem.invoicedate|date}}</td>
            <!-- <td>{{invitem.invoicenumber}}</td> -->
            <td style="width:150px">{{invitem.paymentduedate|date}}</td>
            <td style="width:150px">{{invitem.buyerName||"Not Available"}}</td>
            <!-- <td>{{invitem.buyergst}}</td>
            <td>{{invitem.buyerCityName}}</td>
            <td>{{invitem.buyerStateName}}</td>
             --><td style="width:150px"> {{invitem.supplierName||"Not Available"}}</td>
            <!-- <td>{{invitem.supplierGst}}</td>
            <td>{{invitem.supplierCityName}}</td>
            <td>{{invitem.supplierStateName}}</td>
             --><!-- 
          <td>{{invitem.sgstrate}}</td>
          <td>{{invitem.sgstvalue}}</td>
          <td>{{invitem.cgstrate}}</td>
          <td>{{invitem.cgstvalue}}</td>
          <td>{{invitem.igstrate}}</td>
          <td>{{invitem.igstvalue}}</td> -->
            <td style="width:150px">{{invitem.invoicetotal}}</td>
            <td style="width:150px">{{invitem.paymentbalance}}</td>
            <td style="width:150px">{{invitem.paymentamountpaid}}</td>
            <td style="width:150px"> 
                <p-cellEditor>
                    <ng-template pTemplate="input">
                      <p-dropdown name="approvalstatus" *ngIf="urole==approver" appendTo="body" optionDisabled="New" [options]="Vlaues"  optionValue="valueid" optionLabel="valueName" [(ngModel)]="invitem.approververifiedstatus">
                      </p-dropdown>
                      <p-dropdown name="approvalstatus" *ngIf="urole==checker" [disabled]="checkuser()" appendTo="body" optionDisabled="New" [options]="Vlaues1"  optionValue="valueid" optionLabel="valueName" [(ngModel)]="invitem.approververifiedstatus">
                    </p-dropdown>
                    </ng-template>
                    <ng-template pTemplate="output">
                        
                            <label class={{Vlaues[0].valueClass}} *ngIf="invitem.approververifiedstatus==Vlaues[0].valueid">{{Vlaues[0].valueName}}</label>
                            <label class={{Vlaues[1].valueClass}} *ngIf="invitem.approververifiedstatus==Vlaues[1].valueid">{{Vlaues[1].valueName}}</label>
                            <label class={{Vlaues[2].valueClass}} *ngIf="invitem.approververifiedstatus==Vlaues[2].valueid">{{Vlaues[2].valueName}}</label>
                            <label class={{Vlaues[3].valueClass}} *ngIf="invitem.approververifiedstatus==Vlaues[3].valueid">{{Vlaues[3].valueName}}</label>
                            <label class={{Vlaues[4].valueClass}} *ngIf="invitem.approververifiedstatus==Vlaues[4].valueid">{{Vlaues[4].valueName}}</label>
                            <label *ngIf="invitem.approververifiedstatus==0">Not Defined</label>
                    </ng-template>
                </p-cellEditor>
            </td>
            <td style="width:auto">
                
                <p-button   class="mx-2  p-button-text" [disabled]="invitem.invoicefromadminorauction==8" (onClick)="showItem(invitem)" >   
                    <i class="fa fa-eye"> </i>
                </p-button> 
                <p-button class="p-button-rounded mx-2"  [disabled]="invitem.invoicefromadminorauction==8" (onClick)="editInvoice(invitem)"> <i class="fa fa-pencil" aria-hidden="true"></i> </p-button> 
                <p-button class="p-button-rounded mx-2" [disabled]="invitem.paymentbalance<=0" (onClick)="payInvoice(invitem)"> Pay </p-button> 
               <!--  <button *ngIf="!editing" pButton pRipple type="button" pInitEditableRow icon="pi pi-pencil" (click)="onRowEditInit(invitem)" class="p-button-rounded p-button-text"></button>
                    <button *ngIf="editing" pButton pRipple type="button" pSaveEditableRow icon="pi pi-check" (click)="onRowEditSave(invitem)" class="p-button-rounded p-button-text p-button-success mr-2"></button>
                    <button *ngIf="editing" pButton pRipple type="button" pCancelEditableRow icon="pi pi-times" (click)="onRowEditCancel(invitem, ri)" class="p-button-rounded p-button-text p-button-danger"></button>
                 -->
                 <button *ngIf="!editing" [hidden]="urole==maker||urole==0" pButton type="button" pInitEditableRow icon="pi pi-check"
            class="ui-button-info" (click)="onRowEditInit(invitem)"></button>
        <button *ngIf="editing" pButton type="button" pSaveEditableRow icon="pi pi-check"
            class="ui-button-success" style="margin-right: .5em" (click)="onRowEditSave(invitem)"></button>
        <button *ngIf="editing" pButton type="button" pCancelEditableRow icon="pi pi-times"
            class="ui-button-danger" (click)="onRowEditCancel(invitem, ri)"></button>

            </td>

        </tr>
    </ng-template>

</p-table>


<p-dialog id="content" position="top" #content  header="Invoice Details" width="800" height="200" [(visible)]="displayDialog" [responsive]="true"
[style]="{width: '80vw',top:'6vh'}"  showEffect="fade" [modal]="true">
<iframe *ngIf="reportUrl" [src]="reportUrl" frameborder="10" allowfullscreen width="100%" height="700px"></iframe>
</p-dialog>

<p-dialog id="content" #content  position="center" [style]="{width: '80vw',top:'5vh'}" header="Invoice Payment"  [(visible)]="payinvoice" [responsive]="true"
    showEffect="fade" [modal]="true">
<app-invoicepayment  [payinvoicedetails]="selectedInvoice" (paystatus)="emitevent($event)"></app-invoicepayment>
</p-dialog>
